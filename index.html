<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resolver Desigualdades</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      padding: 40px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      width: 100%;
      max-width: 400px;
      margin: 10px 0;
    }
    #resultado {
      margin-top: 20px;
      font-weight: bold;
      color: #003366;
    }
    #grafico {
      margin-top: 30px;
      width: 100%;
      height: 400px;
    }
  </style>
</head>
<body>

  <h2>Resolver Desigualdades Lineales y Cuadr√°ticas</h2>
  <p>Ejemplos v√°lidos: <code>x^2 - 4x &lt;= 0</code> o <code>2x + 5 &gt; 11</code></p>

  <input id="entrada" type="text" placeholder="Ingresa una desigualdad con x">
  <button onclick="resolverDesigualdad()">Resolver y Graficar</button>

  <div id="resultado"></div>
  <div id="grafico"></div>

  <script>
    function resolverDesigualdad() {
      const input = document.getElementById("entrada").value.replace(/\s+/g, "");
      const resultadoDiv = document.getElementById("resultado");
      const graficoDiv = document.getElementById("grafico");

      const operadores = ["<=", ">=", "<", ">"];
      const operador = operadores.find(op => input.includes(op));
      if (!operador) {
        resultadoDiv.innerHTML = "‚ö†Ô∏è Usa un operador v√°lido: <, <=, > o >=";
        return;
      }

      const [lhs, rhs] = input.split(operador);
      const ladoIzq = math.simplify(lhs);
      const ladoDer = math.simplify(rhs);
      const expresion = math.simplify(`${ladoIzq} - (${ladoDer})`);
      const funcion = expresion.toString();

      const grado = math.degree(expresion, 'x');
      let solucion = "";

      try {
        if (grado === 1) {
          const root = math.solve(`${funcion} = 0`, 'x')[0];
          if (operador === '>') solucion = `x ‚àà (${root}, ‚àû)`;
          if (operador === '>=') solucion = `x ‚àà [${root}, ‚àû)`;
          if (operador === '<') solucion = `x ‚àà (-‚àû, ${root})`;
          if (operador === '<=') solucion = `x ‚àà (-‚àû, ${root}]`;
        } else if (grado === 2) {
          const f = math.parse(funcion);
          const coef = math.coefficients(f, 'x');
          const [a, b, c] = [coef[2] || 0, coef[1] || 0, coef[0] || 0];
          const disc = b*b - 4*a*c;

          if (disc < 0) {
            solucion = ((operador === '<' || operador === '<=') && a > 0)
              ? "x ‚àà ‚Ñù (siempre verdadera)"
              : "No hay soluci√≥n real.";
          } else {
            const x1 = (-b - Math.sqrt(disc)) / (2*a);
            const x2 = (-b + Math.sqrt(disc)) / (2*a);
            const [min, max] = [Math.min(x1, x2), Math.max(x1, x2)];

            if (operador === '<') solucion = `x ‚àà (${min}, ${max})`;
            if (operador === '<=') solucion = `x ‚àà [${min}, ${max}]`;
            if (operador === '>') solucion = `x ‚àà (-‚àû, ${min}) ‚à™ (${max}, ‚àû)`;
            if (operador === '>=') solucion = `x ‚àà (-‚àû, ${min}] ‚à™ [${max}, ‚àû)`;
          }
        } else {
          solucion = "‚ö†Ô∏è Solo se admiten desigualdades de primer o segundo grado.";
        }

        resultadoDiv.innerHTML = "üìå Soluci√≥n: " + solucion;

        // Gr√°fica de la funci√≥n
        const x_vals = math.range(-10, 10, 0.1).toArray();
        const y_vals = x_vals.map(x => {
          try {
            return expresion.evaluate({x});
          } catch {
            return NaN;
          }
        });

        Plotly.newPlot(graficoDiv, [{
          x: x_vals,
          y: y_vals,
          type: 'scatter',
          mode: 'lines',
          name: `f(x) = ${funcion}`,
          line: { color: 'blue' }
        }], {
          title: `Gr√°fica de f(x) = ${funcion}`,
          xaxis: { title: 'x' },
          yaxis: { title: 'f(x)' },
          margin: { t: 40 }
        });

      } catch (err) {
        resultadoDiv.innerHTML = "‚ö†Ô∏è Ocurri√≥ un error al procesar la desigualdad.";
      }
    }
  </script>

</body>
</html>
